<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
    <link rel="canonical" href="/800-63-4/sp800-63c/GenIdP/">

    <!-- Google Analytics -->
    <!--<script type="text/javascript" id="_fed_an_js_tag" src="http://www.nist.gov/js/federated-analytics.all.min.js?agency=NIST&subagency=mml&pua=UA-66610693-1&yt=true&exts=ppsx,pps,f90,sch,rtf,wrl,txz,m1v,xlsm,msi,xsd,f,tif,eps,mpg,xml,pl,xlt,c"></script> -->
    <!-- DAP Analytics -->
    <script type="text/javascript" id="_fed_an_ua_tag"
            src="https://dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=DOC&subagency=NIST&pua=UA-66610693-1&yt=true&exts=ppsx,pps,f90,sch,rtf,wrl,txz,m1v,xlsm,msi,xsd,f,tif,eps,mpg,xml,pl,xlt,c"></script>

	<link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
	<script src="https://code.jquery.com/jquery-3.6.2.min.js" type="text/javascript"></script>
	<script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>
	<script src="https://unpkg.com/simple-jekyll-search/dest/simple-jekyll-search.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/800-63-4/static/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/800-63-4/static/css/NISTStyle.css">
    <link rel="stylesheet" href="/800-63-4/static/css/NISTPages.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    
    <title>General-Purpose IdP</title>
    <meta property="og:title" content="General-Purpose IdP"/>
    

    
    <meta name="description" content="NIST Special Publication 800-63 Digital Identity Guidelines">
    <meta property="og:description" content="NIST Special Publication 800-63 Digital Identity Guidelines"/>
    
</head>


<body>

<nav class="navbar navbar-default navbar-fixed-left" role="navigation">
	<ul class="nav navbar-nav">
      <li id="search-box">
        <input type="text" id="search-input" placeholder="Search..." onFocus="loadSearch()">
        <ul id="results-container"></ul>
      </li>
      
        
        
        
        <li class="">
          
              <a href="/800-63-4/">Home</a>
          
          
          
          
          
        </li>
      
        
        
        
        <li class="">
          
              <a href="/800-63-4/sp800-63/introduction/">SP 800-63</a>
          
          
          
          
          
        </li>
      
        
        
        
        <li class="">
          
              <a href="/800-63-4/sp800-63a/introduction/">SP 800-63A</a>
          
          
          
          
          
        </li>
      
        
        
        
        <li class="">
          
              <a href="/800-63-4/sp800-63b/introduction/">SP 800-63B</a>
          
          
          
          
          
        </li>
      
        
        
        
        <li class="active">
          
              <a href="/800-63-4/sp800-63c/introduction/">SP 800-63C</a>
          
          
          
        
            
            
            
            <ul class="subnav">
            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/abstract/">Abstract</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/reviewers/">Reviewers</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/preface/">Preface</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/introduction/"><span class="section">1</span>Introduction</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/fal/"><span class="section">2</span>FAL</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/Federation/"><span class="section">3</span>Federation</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class="active"><a href="/800-63-4/sp800-63c/GenIdP/"><span class="section">4</span>General-Purpose IdP</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/Wallets/"><span class="section">5</span>Wallets</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/security/"><span class="section">6</span>Security</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/privacy/"><span class="section">7</span>Privacy</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/usability/"><span class="section">8</span>Usability</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/equity/"><span class="section">9</span>Equity</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/examples/"><span class="section">10</span>Examples</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/references/">References</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/abbreviations/"><span class="section">A</span>Abbreviations</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/glossary/"><span class="section">B</span>Glossary</a></li>
                
              
              

            
              
              
              
                
                
                
                
                
                    <li class=""><a href="/800-63-4/sp800-63c/changelog/"><span class="section">C</span>Changelog</a></li>
                
              
              

            
          
            </ul>
          
          
          
        </li>
      
      
      
  </ul>

</nav>


<div class="page-switch">

View this document as: <a href="/800-63-4/sp800-63c.html">a single page</a> | <b>multiple pages</b>.

</div>

<div class="container">
  <div class="row">





  

  

<h1 id="GenIdP" data-section="4">
  
  
    General-Purpose IdPs <a href="#GenIdP" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h1>
    

<p><em>This section is normative.</em></p>

<p>When the IdP is hosted on a service and not on the subscriber’s device, or when the IdP represents multiple subscribers, the IdP is known as a <em>general-purpose IdP</em> and the following requirements apply.</p>

<p>Digital wallets that are deployed to networked systems and not to subscriber devices are considered general-purpose IdPs for the purposes of these guidelines.</p>
<h2 id="idp-account-provisioning" data-section="4">
  
  
    IdP Account Provisioning <a href="#idp-account-provisioning" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h2>
    

<p>In order to make subscriber accounts available through an IdP, the subscriber accounts need to be provisioned at the IdP. The means by which the subscriber account is provisioned to the IdP <strong>SHALL</strong> be disclosed in the trust agreement.</p>

<p>Due to the requirement for the IdP to be able to authenticate the subscriber, the IdP is often a service of the CSP, where the IdP has some level of access to the attributes and authenticators in the subscriber account. Such IdPs are generally in the same security domain as the IdAM that houses the subscriber account. In other cases, one or more authenticators in the subscriber account can be verified outside of the security domain, such as authenticators tied to a common PKI.</p>

<p>The IdP augments the subscriber account with federation-specific attributes, such as a subject identifier. The IdP can collect additional attributes, subject to the privacy and storage requirements enumerated by the trust agreement.</p>

<p>Once the subscriber account is provisioned to the IdP, the CSP is no longer an active participant in the federation process.
Consequently, even if the RP fetches attributes through an identity API hosted by the CSP, the identity API is considered a function of the IdP and not the CSP for the purposes of these guidelines.</p>

<div latex-literal="true" class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\clearpage
</code></pre></div></div>
<h2 id="federation-transaction" data-section="4">
  
  
    Federation Transaction <a href="#federation-transaction" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h2>
    

<p>A federation transaction involving a general-purpose IdP establishes the subscriber account at the IdP and culminates in an authenticated session for the subscriber at the RP. This process is shown in <a href="/800-63-4/sp800-63c/GenIdP/#fig-6">Fig. 6</a>.</p>

<p latex-ignore="true"><a href="/800-63-4/sp800-63c/Federation/#fig-6" name="fig-6">Fig. 6. Federation Overview</a></p>

<p><img src="/800-63-4/sp800-63c/images/federation.png" alt="Overview diagram of federated authentication systems showing parties involved and major steps in the process." title="Federation Overview" latex-src="federation.pdf" latex-fig="6" latex-place="h" /></p>

<p>A federation transaction is a multi-stage process:</p>

<ol>
  <li>
    <p>Before federation can occur, the subscriber account is established by the CSP. This account binds the identity attributes collected by the CSP to a set of authenticators used by the subscriber.</p>
  </li>
  <li>
    <p>The subscriber account is provisioned at the IdP. The IdP augments the subscriber account with federation-specific attributes, such as a subject identifier.</p>
  </li>
  <li>
    <p>The IdP and RP perform discovery and registration to establish the cryptographic keys and identifiers needed for information to be securely exchanged between the parties in the federation protocol. While there may have been an existing policy decision representing a permission to connect (through an apriori trust agreement), this step entails a connection and integration at the technical level. This stage can occur before any subscriber tries to access the RP or as a response to a subscriber’s attempt to use an IdP at an RP.</p>
  </li>
  <li>
    <p>The IdP and RP begin a federated authentication transaction to authenticate a subscriber to the RP. As part of this, the set of attributes that is to be passed to the RP is selected from a subset of what the RP has requested, what is allowed by the trust agreement, and what is permitted by the authorized party. If necessary, the authorized party is prompted at runtime to approve the release of attributes.</p>
  </li>
  <li>
    <p>The subscriber authenticates to the IdP using an authenticator bound to the subscriber account.</p>
  </li>
  <li>
    <p>The IdP creates an assertion to represent the results of the authentication event. The assertion is based on terms established by the trust agreement, the request from the RP, the capabilities of the IdP, the subscriber account known to the IdP, and the attributes permitted by the authorized party.</p>
  </li>
  <li>
    <p>The assertion is passed to the RP across the network.</p>
  </li>
  <li>
    <p>The RP processes this assertion from the IdP and establishes an authenticated session with the subscriber. Optionally, the RP receives identity attributes from the IdP representing the subscriber account, either in the assertion or through an identity API.</p>
  </li>
</ol>

<p>In all transactions, the parties involved enter into a trust agreement, described in <a href="/800-63-4/sp800-63c/Federation/#trust-agreement">Sec. 3.4</a>. This agreement establishes which parties are fulfilling which roles, and its execution represents initial permission for the systems in question to connect. The list of available subscriber identity attributes is established in this step, though the decision of which attributes are released to a given RP for a given transaction is finalized during the federation transaction itself.</p>

<p>In a federated identity transaction, the IdP is the source of identity and authentication attributes for the RP. The normal flow of information for a federation transaction is from the IdP to the RP. Due to the directional nature of this information flow, the IdP is considered to be <em>upstream</em> of the RP and the RP is considered to be <em>downstream</em> of the IdP. It is also possible for additional information to flow back up from the RP, particularly through use of shared signals as discussed in <a href="/800-63-4/sp800-63c/GenIdP/#shared-signals">Sec. 4.8</a>.</p>

<div latex-literal="true" class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\clearpage
</code></pre></div></div>
<h2 id="trust-agreements" data-section="4">
  
  
    Trust Agreements <a href="#trust-agreements" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h2>
    

<p>Trust agreements <strong>SHALL</strong> be established either:</p>

<ul>
  <li>as the result of an agreement by the federated parties, prior to the federation transaction, or</li>
  <li>as the result of decision or action by the subscriber, during the federation transaction.</li>
</ul>
<h3 id="apriori-trust-agreement-establishment" data-section="4">
  
  
    Apriori Trust Agreement Establishment <a href="#apriori-trust-agreement-establishment" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h3>
    

<p>When the trust agreement is established by the federated parties prior to the federation transaction, the trust agreement <strong>SHALL</strong> establish the following terms, which <strong>MAY</strong> vary per IdP and RP relationship:</p>

<ul>
  <li>The set of subscriber attributes the CSP makes available to the IdP as part of the subscriber account</li>
  <li>The set of subscriber attributes the IdP can make available to the RP</li>
  <li>The attribute storage policy of the IdP for the subscriber account, including any available means for the subscriber to request deletion</li>
  <li>Any additional attribute sources that the IdP receives applicable subscriber attributes from</li>
  <li>What if any identity APIs are made available by the IdP, either directly or through an external provider, and which subscriber attributes are available at these APIs</li>
  <li>The population of subscriber accounts that the IdP can create assertions for</li>
  <li>Any additional uses of subscriber information, beyond providing the identity service</li>
  <li>The set of subscriber attributes that the RP will request (a subset of the attributes made available)</li>
  <li>The purpose for each attribute requested by the RP</li>
  <li>The attribute storage policy of the RP for the RP subscriber account, including any available means for the subscriber to request deletion</li>
  <li>The use of any shared signaling between the IdP and RP</li>
  <li>The authorized party responsible for decisions regarding the release of subscriber attributes to the RP (e.g., the IdP organization, the subscriber, etc.)</li>
  <li>The means of informing subscribers about attribute release to the RP</li>
  <li>The xALs available from the IdP</li>
  <li>The xALs required by the RP</li>
</ul>

<p>The terms of the trust agreement <strong>SHALL</strong> be available to the operators of the RP and the IdP upon its establishment. The terms of the trust agreement <strong>SHALL</strong> be made available to subscribers upon request to the IdP or RP.</p>

<p>The IdP and RP <strong>SHALL</strong> each assess their respective redress mechanisms for their efficacy in achieving a resolution of complaints or problems and disclose the results of this assessment as part of the trust agreement. See <a href="/800-63-4/sp800-63c/Federation/#redress">Sec. 3.4.3</a> for additional requirements and considerations for redress mechanisms.</p>

<p>If FAL3 is allowed within the trust agreement, the trust agreement <strong>SHALL</strong> stipulate the following terms regarding holder-of-key assertions and bound authenticators (see <a href="/800-63-4/sp800-63c/Federation/#idp-managed-bound-authn">Sec. 3.14</a> and <a href="/800-63-4/sp800-63c/Federation/#bound-authn">Sec. 3.15</a>):</p>

<ul>
  <li>The means by which holder-of-key assertions can be verified by the RP (such as a common trusted PKI system)</li>
  <li>The means by which the RP can associate holder-of-key assertions with specific RP subscriber accounts (such as attribute-based account resolution or pre-provisioning)</li>
  <li>Whether bound authenticators are supplied by the RP or by the subscriber</li>
  <li>Documentation of the binding ceremony used for any subscriber-provided bound authenticators</li>
</ul>

<p>Runtime decisions at the IdP, as described in <a href="/800-63-4/sp800-63c/GenIdP/#idp-runtime-decision">Sec. 4.6.1.3</a>, <strong>MAY</strong> be used to further limit which subscriber attributes are sent between parties in the federated authentication process (e.g., a runtime decision could opt to not disclose an email address even though this attribute was included in the terms of the trust agreement).</p>

<p>The IdP and RP <strong>SHALL</strong> exchange only the minimum data necessary to achieve the function of the system.</p>

<p>The trust agreement <strong>SHALL</strong> be reviewed periodically to ensure it is still fit for purpose, and to avoid unnecessary data exchange and over-collection of subscriber data.</p>
<h3 id="subscriber-driven-trust-agreement-establishment" data-section="4">
  
  
    Subscriber-driven Trust Agreement Establishment <a href="#subscriber-driven-trust-agreement-establishment" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h3>
    

<p>When the trust agreement is established as the result of a subscriber’s decision, such as a subscriber starting a federation transaction between an RP and their IdP who have no established agreement, the trust agreement is anchored by the subscriber. Consequently, the following terms <strong>SHALL</strong> be disclosed to the subscriber upon request to the IdP and to the RP during the runtime decision at the IdP as described in <a href="/800-63-4/sp800-63c/GenIdP/#idp-runtime-decision">Sec. 4.6.1.3</a>:</p>

<ul>
  <li>The set of subscriber attributes the CSP makes available to the IdP</li>
  <li>Any additional attribute sources that the IdP receives applicable subscriber attributes from</li>
  <li>What if any identity APIs are made available by the IdP, either directly or through an external provider, and which subscriber attributes are available at these APIs</li>
  <li>The set of subscriber attributes the IdP can make available to the RP</li>
  <li>The attribute storage policy of the IdP for the subscriber account, including any available means for the subscriber to request deletion</li>
  <li>The use of any shared signaling between the IdP and RP</li>
  <li>The population of subscriber accounts that the IdP can create assertions for</li>
  <li>Any additional uses of subscriber information, beyond providing the identity service</li>
  <li>The xALs available from the IdP</li>
</ul>

<p>The IdP <strong>SHALL</strong> assess its redress mechanisms for their efficacy in achieving a resolution of complaints or problems and disclose the results of this assessment to the subscriber. See <a href="/800-63-4/sp800-63c/Federation/#redress">Sec. 3.4.3</a> for additional requirements and considerations for redress mechanisms.</p>

<p>The release of subscriber attributes <strong>SHALL</strong> be managed using a runtime decision at the IdP, as described in <a href="/800-63-4/sp800-63c/GenIdP/#idp-runtime-decision">Sec. 4.6.1.3</a>. The authorized party <strong>SHALL</strong> be the subscriber.</p>

<p>The following terms of the trust agreement <strong>SHALL</strong> be disclosed to the subscriber during the runtime decision:</p>

<ul>
  <li>The set of subscriber attributes that the RP will request (a subset of the attributes made available by the IdP)</li>
  <li>The purpose for each attribute requested by the RP</li>
  <li>The attribute storage policy of the RP for the RP subscriber account, including any available means for the subscriber to request deletion</li>
  <li>The xALs required by the RP</li>
</ul>

<p>Note that all information disclosed to the subscriber needs to be conveyed in a manner that is understandable and actionable, as discussed in <a href="/800-63-4/sp800-63c/usability/#usability">Sec. 8</a>.</p>
<h2 id="discovery-and-registration" data-section="4">
  
  
    Discovery and Registration <a href="#discovery-and-registration" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h2>
    

<p>To perform a federation transaction with a general-purpose IdP, the RP <strong>SHALL</strong> associate the assertion signing keys and other relevant configuration information with the IdP’s identifier, as stipulated by the trust agreement. If these are retrieved over a network connection, request and retrieval <strong>SHALL</strong> be made over a secure protected channel from a location associated with the IdP’s identifier by the trust agreement. In many federation protocols, this is accomplished by the RP fetching the public keys and configuration data from a URL known to be controlled by the IdP or offered on the IdP’s behalf. It is also possible for the RP to be configured directly with this information in a static fashion, whereby the RP’s administrator enters the IdP information directly into the RP software.</p>

<p>Additionally, the RP <strong>SHALL</strong> register its information either with the IdP or with an authority the IdP trusts, as stipulated by the trust agreement. In many federation protocols, the RP is assigned an identifier during this stage, which the RP will use in subsequent communication with the IdP.</p>

<p>In all of these requirements, the IdP <strong>MAY</strong> use a trusted third party to facilitate its discovery and registration processes, so long as that trusted third party is identified in the trust agreement. For example, a consortium could make use of a hosted service that collects the configuration records of IdPs and RPs directly from participants. Instead of going to the IdP directly for its discovery record, an RP would instead go to this service. The IdP would in turn go to this service to find the identifiers and configuration information for RPs that are needed to connect.</p>
<h3 id="manual-registration" data-section="4">
  
  
    Manual Registration <a href="#manual-registration" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h3>
    

<p>At all FALs, the cryptographic keys and identifiers of the RP and IdP can be exchanged in a manual process, whereby the administrator of the RP submits the RP’s configuration to the IdP (either directly or through a trusted third party) and receives the identifier to use with that IdP. The RP administrator then configures the RP with this identifier and any additional information needed for the federation transaction to continue.</p>

<p>As this is a manual process, the registration happens prior to the federation transaction beginning.</p>

<p>This process <strong>MAY</strong> be facilitated by some level of automated tooling, whereby the manual configuration points the systems in question to a trusted source of information that can be updated over time. If such automation is used, the trust agreement <strong>SHALL</strong> enumerate the allowable terms of the cryptographic key distribution and assignment, including allowable cache lifetimes.</p>
<h3 id="dynamic-registration" data-section="4">
  
  
    Dynamic Registration <a href="#dynamic-registration" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h3>
    

<p>At FAL1 and FAL2, the cryptographic keys and identifiers of the RP can be exchanged in a dynamic process, whereby the RP software presents its configuration to the IdP (either directly or through a trusted third party) and receives the identifier to use with that IdP. This process is specific to the federation protocol in use but requires machine-readable configuration data to be made available over the network. All transmission of configuration information <strong>SHALL</strong> be made over a secure protected channel to endpoints associated with the IdP’s identifier by the trust agreement.</p>

<p>IdPs <strong>SHOULD</strong> consider the risks of information leakage to multiple RP instances and take appropriate countermeasures, such as issuing PPIs to dynamically registered RPs as discussed in <a href="/800-63-4/sp800-63c/Federation/#ppi">Sec. 3.3.1</a>.</p>

<p>Dynamic registration <strong>SHOULD</strong> be augmented by attestations about the RP software and device, as discussed in <a href="/800-63-4/sp800-63c/Federation/#attestations">Sec. 3.5.3</a>.</p>

<p><a href="/800-63-4/sp800-63c/references/#ref-OIDC-registration">[OIDC-Registration]</a> defines a protocol for dynamic registration of RPs at an OpenID Connect IdP.</p>
<h2 id="subscriber-authentication-at-the-idp" data-section="4">
  
  
    Subscriber Authentication at the IdP <a href="#subscriber-authentication-at-the-idp" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h2>
    

<p>In a federation context, the IdP acts as the verifier for the authenticator bound to the subscriber account, as described in <a href="/800-63-4/sp800-63b/introduction/#introduction" latex-href="#ref-SP800-63B">[SP800-63B]</a>.
Verification of the authenticator creates an authentication event which begins the authenticated session at the IdP. This authenticated session serves as the basis of the IdP’s claim that the subscriber is present.</p>

<p>The IdP <strong>SHALL</strong> require the subscriber to have an authenticated session before any of the following events:</p>

<ul>
  <li>Approval of attribute release</li>
  <li>Creation and issuance of an assertion</li>
  <li>Establishment of a subscriber-driven trust agreement.</li>
</ul>

<p>Additional requirements for session management and reauthentication are discussed in <a href="/800-63-4/sp800-63c/GenIdP/#federation-session">Sec. 4.7</a>.</p>
<h2 id="authentication-and-attribute-disclosure" data-section="4">
  
  
    Authentication and Attribute Disclosure <a href="#authentication-and-attribute-disclosure" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h2>
    

<p>The decision of whether a federation transaction proceeds <strong>SHALL</strong> be determined by the authorized party stipulated by the trust agreement. The decision can be calculated in a variety of ways, including:</p>

<ul>
  <li>an allowlist, which determines the circumstances under which the system can allow the federation transaction to proceed in an automated fashion;</li>
  <li>a blocklist, which determines the circumstances under which the system will not allow the federation transaction to proceed; and</li>
  <li>a runtime decision, which allows the authorized party to decide if the transaction can proceed and under what precise terms. Note that a runtime decision can be stored and applied to future transactions.</li>
</ul>

<p>The applicability of an allowlist, blocklist, or runtime decision can be influenced by aspects of the federation transaction, including the identity of the IdP and RP, the subscriber attributes requested, the xAL required, and other factors. These decisions can be facilitated by risk management systems, federation authorities, and local system policies.</p>

<p>For a non-normative example of an RP that has been allowlisted at an IdP for a set of subscribers to facilitate single-sign-on for an enterprise application, see <a href="/800-63-4/sp800-63c/examples/#enterprise-sso">Sec. 10.5</a>.</p>

<p>The IdP <strong>SHALL</strong> provide effective mechanisms for redress of subscriber complaints or problems (e.g., subscriber identifies an inaccurate attribute value). See <a href="/800-63-4/sp800-63c/Federation/#redress">Sec. 3.4.3</a> for additional requirements and considerations for redress mechanisms.</p>
<h3 id="idp-controlled-decisions" data-section="4">
  
  
    IdP-Controlled Decisions <a href="#idp-controlled-decisions" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h3>
    
<h4 id="idp-allowlist" data-section="4">
  
  
    IdP Allowlists of RPs <a href="#idp-allowlist" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h4>
    

<p>In an a priori trust agreement, IdPs <strong>MAY</strong> establish allowlists of RPs authorized to receive authentication and attributes from the IdP without a runtime decision from the subscriber. When placing an RP on its allowlist, the IdP <strong>SHALL</strong> confirm that the RP abides the terms of the trust agreement. The IdP <strong>SHALL</strong> determine which identity attributes are passed to the allowlisted RP upon authentication. IdPs <strong>SHALL</strong> make allowlists available to subscribers as described in <a href="/800-63-4/sp800-63c/privacy/#notice">Sec. 7.2</a>.</p>

<p>IdP allowlists <strong>SHALL</strong> uniquely identify RPs through the means of domain names, cryptographic keys, or other identifiers applicable to the federation protocol in use. Any entities that share an identifier <strong>SHALL</strong> be considered equivalent for the purposes of the allowlist. Allowlists <strong>SHOULD</strong> be as specific as possible to avoid unintentional impersonation of an RP.</p>

<p>IdP allowlist entries for an RP <strong>SHALL</strong> indicate which attributes are included as part of an allowlisted decision. If additional attributes are requested by the RP, the request <strong>SHALL</strong> be either:</p>

<ul>
  <li>subject to a runtime decision of the authorized party to approve the additional attributes requested,</li>
  <li>redacted to only the attributes in the allowlist entry, or</li>
  <li>denied outright by the IdP.</li>
</ul>

<p>IdP allowlists <strong>MAY</strong> include other information, such as the xALs under which the allowlist entry is applied. For example, an IdP could use an allowlist entry to bypass a consent screen for an FAL1 transaction but require confirmation of consent from the subscriber during an FAL3 transaction.</p>
<h4 id="idp-blocklists-of-rps" data-section="4">
  
  
    IdP Blocklists of RPs <a href="#idp-blocklists-of-rps" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h4>
    

<p>IdPs <strong>MAY</strong> establish blocklists of RPs not authorized to receive authentication assertions or attributes from the IdP, even if requested to do so by the subscriber. If an RP is on an IdP’s blocklist, the IdP <strong>SHALL NOT</strong> produce an assertion targeting the RP in question under any circumstances.</p>

<p>IdP blocklists <strong>SHALL</strong> uniquely identify RPs through the means of domain names, cryptographic keys, or other identifiers applicable to the federation protocol in use. Any entities that share an identifier <strong>SHALL</strong> be considered equivalent for the purposes of the blocklist. For example, a wildcard domain identifier of “*.example.com” would match the domains “www.example.com”, “service.example.com”, and “unknown.example.com” equally. All three of these sites would blocked by the same blocklist entry.</p>
<h4 id="idp-runtime-decision" data-section="4">
  
  
    IdP Runtime Decisions <a href="#idp-runtime-decision" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h4>
    

<p>Every RP that is in a trust agreement with an IdP but not on an allowlist with that IdP <strong>SHALL</strong> be governed by a default policy in which runtime authorization decisions will be made by an authorized party identified by the trust agreement. Since the runtime decision occurs during the federation transaction, the authorized party is generally a person and, in most circumstances, is the subscriber; however, it is possible for another party such as an administrator to be prompted on behalf of the subscriber. Note that in a subscriber-driven trust agreement, a runtime decision with the subscriber is the only allowable means to authorize the release of subscriber attributes.</p>

<p>When processing a runtime decision, the IdP prompts the authorized party interactively during the federation transaction. The authorized party provides consent to release an authentication assertion and specific attributes to the RP. The IdP <strong>SHALL</strong> provide the authorized party with explicit notice and prompt them for positive confirmation before any attributes about the subscriber are transmitted to the RP. At a minimum, the notice <strong>SHOULD</strong> be provided by the party in the position to provide the most effective notice and obtain confirmation, consistent with <a href="/800-63-4/sp800-63c/privacy/#notice">Sec. 7.2</a>. The IdP <strong>SHALL</strong> disclose which attributes will be released to the RP if the transaction is approved. If the federation protocol in use allows for optional or selective attribute disclosure at runtime, the authorized party <strong>SHALL</strong> be given the option to decide whether to transmit specific attributes to the RP without terminating the federation transaction entirely.</p>

<p>If the authorized party is the subscriber, the IdP <strong>SHALL</strong> provide mechanisms for the subscriber to view the attribute values and derived attribute values to be sent to the RP. To mitigate the risk of unauthorized exposure of sensitive information (e.g., shoulder surfing), the IdP <strong>SHALL</strong>, by default, mask sensitive information displayed to the subscriber. For more details on masking, see <a href="/800-63-4/sp800-63c/usability/#usability">Sec. 8</a> on usability considerations.</p>

<p>An IdP <strong>MAY</strong> employ mechanisms to remember and re-transmit the same set of attributes to the same RP, remembering the authorized party’s decision. This mechanism is associated with the subscriber account as managed by the IdP. If such a mechanism is provided, the IdP <strong>SHALL</strong> allow the authorized party to revoke such remembered access at a future time.</p>
<h3 id="rp-controlled-decisions" data-section="4">
  
  
    RP-Controlled Decisions <a href="#rp-controlled-decisions" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h3>
    
<h4 id="rp-allowlists-of-idps" data-section="4">
  
  
    RP Allowlists of IdPs <a href="#rp-allowlists-of-idps" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h4>
    

<p>RPs <strong>MAY</strong> establish allowlists of IdPs from which the RP will accept authentication and attributes without a runtime decision from the subscriber to use the IdP. In practice, many RPs interface with only a single IdP, and this IdP is allowlisted as the only possible entry for that RP. When placing an IdP in its allowlist, the RP <strong>SHALL</strong> confirm that the IdP abides by the terms of the trust agreement. Note that this confirmation can be facilitated by a federation authority or be undertaken directly by the RP.</p>

<p>RP allowlists <strong>SHALL</strong> uniquely identify IdPs through the means of domain names, cryptographic keys, or other identifiers applicable to the federation protocol in use.</p>

<p>RP allowlist entries <strong>MAY</strong> be applied based on aspects of the subscriber account (such as the xALs required for the transaction). For example, an RP could use a runtime decision for FAL1 transactions but require an allowlisted IdP for FAL3 transactions.</p>
<h4 id="rp-blocklists-of-idps" data-section="4">
  
  
    RP Blocklists of IdPs <a href="#rp-blocklists-of-idps" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h4>
    

<p>RPs <strong>MAY</strong> also establish blocklists of IdPs that the RP will not accept authentication or attributes from, even when requested by the subscriber. A blocklisted IdP can be otherwise in a valid trust agreement with the RP, for example if both are under the same federation authority.</p>

<p>RP blocklists <strong>SHALL</strong> uniquely identify IdPs through the means of domain names, cryptographic keys, or other identifiers applicable to the federation protocol in use.</p>
<h4 id="rp-runtime-decision" data-section="4">
  
  
    RP Runtime Decisions <a href="#rp-runtime-decision" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h4>
    

<p>Every IdP that is in a trust agreement with an RP but not on an allowlist with that RP <strong>SHALL</strong> be governed by a default policy in which runtime authorization decisions will be made by the authorized party indicated in the trust agreement. In this mode, the authorized party is prompted by the RP to select or enter which IdP to contact for authentication on behalf of the subscriber. This process can be facilitated through the use of a discovery mechanism allowing the subscriber to enter a human-facing identifier such as an email address. This process allows the RP to programmatically select the appropriate IdP for that identifier. Since the runtime decision occurs during the federation transaction, the authorized party is generally a person and, in most circumstances, is the subscriber.</p>

<p>The RP <strong>MAY</strong> employ mechanisms to remember the authorized party’s decision to use a given IdP. Since this mechanism is employed prior to authentication at the RP, the manner in which the RP provides this mechanism (e.g., a browser cookie outside the authenticated session) is separate from the RP subscriber account described in <a href="/800-63-4/sp800-63c/Federation/#rp-account">Sec. 3.10.1</a>. If such a mechanism is provided, the RP <strong>SHALL</strong> allow the authorized party to revoke such remembered options at a future time.</p>
<h3 id="provisioning" data-section="4">
  
  
    Provisioning Models for RP subscriber accounts <a href="#provisioning" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h3>
    

<p>The lifecycle of the provisioning process for an RP subscriber account varies depending on factors including the trust agreement discussed in <a href="/800-63-4/sp800-63c/Federation/#trust-agreement">Sec. 3.4</a> and the deployment pattern of the IdP and RP. However, in all cases, the RP subscriber account <strong>SHALL</strong> be provisioned at the RP prior to the establishment of an authenticated session at the RP in one of the following ways:</p>

<dl>
  <dt>Just-In-Time Provisioning</dt>
  <dd>An RP subscriber account is created automatically the first time the RP receives an assertion with an unknown federated identifier from an IdP. Any identity attributes learned during the federation process, either within the assertion or through an identity API as discussed in <a href="/800-63-4/sp800-63c/Federation/#s-identity-api">Sec. 3.11.3</a>, <strong>MAY</strong> be associated with the RP subscriber account. Accounts provisioned in this way are bound to the federated identifier in the assertion used to provision them.
This is the most common form of provisioning in federation systems, as it requires the least coordination between the RP and IdP. However, in such systems, the RP <strong>SHALL</strong> be responsible for managing any cached attributes it might have. See <a href="/800-63-4/sp800-63c/GenIdP/#fig-7">Fig. 7</a>.</dd>
</dl>

<p latex-ignore="true"><a href="/800-63-4/sp800-63c/Federation/#fig-7" name="fig-7">Fig. 7. Just-In-Time Provisioning</a></p>

<p><img src="/800-63-4/sp800-63c/images/JIT-Provisioning.png" alt="Diagram of the stages of a just-in-time provisioning of an RP subscriber account based on a subscriber account." title="Just-In-Time Provisioning" latex-src="JIT-Provisioning.pdf" latex-fig="7" latex-place="p" /></p>

<dl>
  <dt>Pre-provisioning</dt>
  <dd>An RP subscriber account is created by the IdP pushing the attributes to the RP or the RP pulling attributes from the IdP. Pre-provisioning of accounts generally occurs in bulk through a provisioning API as discussed in <a href="/800-63-4/sp800-63c/GenIdP/#provisioning-api">Sec. 4.6.5</a>, as the provisioning occurs prior to the represented subscribers authenticating through a federation transaction. Pre-provisioned accounts <strong>SHALL</strong> be bound to a federated identifier at the time of provisioning. Any time a particular federated identifier is seen by the RP, the associated account can be logged in as a result. 
This form of provisioning requires infrastructure and planning on the part of the IdP and RP, but these processes can be facilitated by automated protocols. Additionally, the IdP and RP must keep the set of provisioned accounts synchronized over time as discussed in <a href="/800-63-4/sp800-63c/GenIdP/#attribute-sync">Sec. 4.6.4</a>. See <a href="/800-63-4/sp800-63c/GenIdP/#fig-8">Fig. 8</a>.

    <p>In this model, the RP also receives attributes about subscribers who have not yet interacted with the RP (and who may never do so). This is in contrast to other models, where the RP receives information only about the subset of subscribers that use the RP, and then only after the subscriber uses the RP for the first time. The privacy considerations of the RP having access to this information prior to a federation transaction <strong>SHALL</strong> be accounted for in the trust agreement.</p>
  </dd>
</dl>

<p latex-ignore="true"><a href="/800-63-4/sp800-63c/Federation/#fig-8" name="fig-8">Fig. 8. Pre-Provisioning</a></p>

<p><img src="/800-63-4/sp800-63c/images/Pre-Provisioning.png" alt="Diagram of the stages of a pre-provisioned RP subscriber account based on a subscriber account." title="Pre-Provisioning" latex-src="Pre-Provisioning.pdf" latex-fig="8" latex-place="p" /></p>

<dl>
  <dt>Ephemeral</dt>
  <dd>An RP subscriber account is created when processing the assertion, but then the RP subscriber account is terminated when the authenticated session ends. This process is similar to a just-in-time provisioning, but the RP keeps no long-term record of the account when the session is complete, in accordance with <a href="/800-63-4/sp800-63c/Federation/#store-subscriber-info">Sec. 3.10.3</a>.
This form of provisioning is useful for RPs that fully externalize access rights to the IdP, allowing the RP to be more simplified with less internal state. However, this pattern is not common because even the simplest RPs tend to have a need to track state within the application or at least keep a record of actions associated with the federated identifier. See <a href="/800-63-4/sp800-63c/GenIdP/#fig-9">Fig. 9</a>.</dd>
</dl>

<p latex-ignore="true"><a href="/800-63-4/sp800-63c/Federation/#fig-9" name="fig-9">Fig. 9. Ephemeral Provisioning</a></p>

<p><img src="/800-63-4/sp800-63c/images/Ephemeral-Provisioning.png" alt="Diagram of the stages of an ephemeral RP subscriber account based on a subscriber account." title="Ephemeral Provisioning" latex-src="Ephemeral-Provisioning.pdf" latex-fig="9" latex-place="p" /></p>

<div latex-literal="true" class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\clearpage
</code></pre></div></div>

<dl>
  <dt>Other</dt>
  <dd>Other RP subscriber account provisioning models are possible but the details of such models are outside the scope of these guidelines. The details of any alternative provisioning model <strong>SHALL</strong> be included in the privacy risk assessments of the IdP and RP.</dd>
</dl>

<p>All organizations <strong>SHALL</strong> document their provisioning models as part of their trust agreement.</p>
<h3 id="attribute-sync" data-section="4">
  
  
    Attribute Synchronization <a href="#attribute-sync" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h3>
    

<p>In a federated process, the IdP and RP each have their own stores of identity attributes associated with the subscriber account. The IdP has a direct view of the subscriber account’s attributes, but the RP subscriber account is derived from a subset of those attributes that are presented during the federation transaction. Therefore, it is possible for the IdP’s and RP’s attribute stores to diverge from each other over time.</p>

<p>From the RP’s perspective, the IdP is the trusted source for any attributes that the IdP asserts as being associated with the subscriber account at the IdP. The provenance of the IdP’s attributes, and their validation process, is stipulated in the trust agreement.</p>

<p>However, the RP <strong>MAY</strong> additionally collect, and optionally verify, other attributes to associate with the RP subscriber account, as discussed in <a href="/800-63-4/sp800-63c/GenIdP/#rp-attribute-collection">Sec. 4.6.6</a>. Sometimes, these attributes can even override what is asserted by the IdP. For example, if an IdP asserts a full display name for the subscriber, the RP can allow the subscriber to provide an alternative preferred name for use at the RP.</p>

<p>The IdP <strong>SHOULD</strong> signal downstream RPs when the attributes of a subscriber account available to the RP have been updated, and the RP <strong>MAY</strong> respond to this signal by updating the attributes in the RP subscriber account. This synchronization can be accomplished using shared signaling as described in <a href="/800-63-4/sp800-63c/GenIdP/#shared-signals">Sec. 4.8</a>, through a provisioning API as described in <a href="/800-63-4/sp800-63c/GenIdP/#provisioning-api">Sec. 4.6.5</a>, or by providing a signal in the assertion (e.g., a timestamp indicating when relevant attributes were last updated) allowing the RP to determine that its cache is out of date. If the RP is granted access to an identity API as in <a href="/800-63-4/sp800-63c/Federation/#s-identity-api">Sec. 3.11.3</a>, the IdP <strong>SHOULD</strong> allow the RP access to the API for sufficient time to perform synchronization operations after the federation transaction has concluded. For example, if the assertion is valid for five minutes, access to the identity API could be valid for 30 minutes to allow the RP to fetch and update attributes out of band.</p>

<p>The IdP <strong>SHOULD</strong> signal downstream RPs when a subscriber account is terminated, or when the subscriber account’s access to an RP is revoked. This can be accomplished using shared signaling as described in <a href="/800-63-4/sp800-63c/GenIdP/#shared-signals">Sec. 4.8</a> or through a provisioning API as described in <a href="/800-63-4/sp800-63c/GenIdP/#provisioning-api">Sec. 4.6.5</a>. Upon receiving such a signal, the RP <strong>SHALL</strong> process the RP subscriber account as stipulated in the trust agreement. If the RP subscriber account is terminated, the RP <strong>SHALL</strong> remove all personal information associated with the RP subscriber account, in accordance with <a href="/800-63-4/sp800-63c/Federation/#store-subscriber-info">Sec. 3.10.3</a>. If the reason for termination is suspicious or fraudulent activity, the IdP <strong>SHALL</strong> include this reason in its signal to the RP to allow the RP to review the account’s activity at the RP for suspicious activity, if specified in the trust agreement with that RP.</p>
<h3 id="provisioning-api" data-section="4">
  
  
    Provisioning APIs <a href="#provisioning-api" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h3>
    

<p>As part of some proactive forms of provisioning, the RP can be given access to subscriber attributes through a general-purpose identity API known as a <em>provisioning API</em>. This type of API allows an IdP to push attributes for a range of subscriber accounts, and sometimes allows an RP to query the attributes of these subscriber accounts directly. Since access to the API is granted outside the context of a federation transaction, access to the provisioning API for a given subscriber does not indicate to the RP that a given subscriber has been authenticated.</p>

<p>The attributes in the provisioning API available to a given RP <strong>SHALL</strong> be limited to only those necessary for the RP to perform its functions, including any audit and security purposes as discussed in <a href="/800-63-4/sp800-63c/Federation/#transmit-subscriber-info">Sec. 3.9.1</a>. As part of establishing the trust agreement, the IdP <strong>SHALL</strong> document when an RP is given access to a provisioning API including at least the following:</p>

<ul>
  <li>the purpose for the access using the provisioning model;</li>
  <li>the set of attributes made available to the RP;</li>
  <li>whether the API functions as a push to the RP, a pull from the RP, or both; and</li>
  <li>the population of subscribers whose attributes are made available to the RP.</li>
</ul>

<p>Access to the provisioning API <strong>SHALL</strong> occur over a mutually authenticated protected channel. The exact means of authentication varies depending on the specifics of the API and whether it is a push model (where the IdP connects to the RP) or a pull model (where the RP connects to the IdP).</p>

<p>A provisioning API <strong>SHALL NOT</strong> be made available under a subscriber-driven trust agreement. The IdP <strong>SHALL NOT</strong> make a provisioning API available to any RP outside of an established trust agreement. The IdP <strong>SHALL</strong> provide access to a provisioning API only as part of a federated identity relationship with an RP to facilitate federation transactions with that RP and related functions such as signaling revocation of the subscriber account. The IdP <strong>SHALL</strong> revoke an RP’s access to the provisioning API once access is no longer required by the RP for its functioning purposes or when the trust agreement is terminated.</p>

<p>Any provisioning API provided to the RP <strong>SHALL</strong> be under the control and jurisdiction of the IdP. External attribute providers <strong>MAY</strong> be used as information sources by the IdP to provide attributes through this provisioning API, but the IdP is responsible for the content and accuracy of the information provided by the referenced attribute providers.</p>

<p>When a provisioning API is in use, the IdP <strong>SHALL</strong> signal to the RP when a subscriber account has been terminated. When receiving such a signal, the RP <strong>SHALL</strong> remove the binding of the federated identifier from the account and <strong>SHALL</strong> terminate the account if necessary (e.g., there are no other federated identifiers linked to this account or the trust agreement dictates such an action). The RP <strong>SHALL</strong> remove all personal information sourced from the provisioning API in accordance with <a href="/800-63-4/sp800-63c/Federation/#store-subscriber-info">Sec. 3.10.3</a>.</p>
<h3 id="rp-attribute-collection" data-section="4">
  
  
    Collection of Additional Attributes by the RP <a href="#rp-attribute-collection" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h3>
    

<p>The RP <strong>MAY</strong> collect and maintain additional attributes from the subscriber beyond those provided by the IdP. For example, the RP could collect a preferred display name directly from the subscriber that is not provided by the IdP. The RP could also have a separate agreement with an attribute provider that gives the RP access to an identity API not associated with the IdP. For example, the RP could receive a state license number from the IdP, but use a separate attribute verification API to check if a particular license number is currently valid. The assertion from the IdP binds the license to the subscriber, but the attribute verification API provides additional information beyond what the IdP can share or be authoritative for.</p>

<p>These attributes are governed separately from the trust agreement since they are collected by the RP outside of a federation transaction. All attributes associated with an RP subscriber account, regardless of their source, <strong>SHALL</strong> be removed when the RP subscriber account is terminated, in accordance with <a href="/800-63-4/sp800-63c/Federation/#store-subscriber-info">Sec. 3.10.3</a>.</p>

<p>The RP <strong>SHALL</strong> disclose to the subscriber the purpose for collection of any additional attributes. These attributes <strong>SHALL</strong> be used solely for the stated purposes of the RP’s functionality and <strong>SHALL NOT</strong> have any secondary use, including communication of said attributes to other parties.</p>

<p>The RP <strong>SHALL</strong> provide an effective means of redress for the subscriber to update and remove these additionally-collected attributes from the RP subscriber account. See <a href="/800-63-4/sp800-63c/Federation/#redress">Sec. 3.4.3</a> for additional requirements and considerations for redress mechanisms.</p>

<p>The following requirement applies to federal agencies, regardless of whether they operate their own identity service or use an external CSP as part of their identity service:</p>

<ul>
  <li>An RP <strong>SHALL</strong> disclose any additional attributes collected, and their use, as part of its System of Records Notice (SORN)</li>
</ul>
<h3 id="stale-account" data-section="4">
  
  
    Time-based Removal of RP Subscriber Accounts <a href="#stale-account" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h3>
    

<p>If an RP is using a just-in-time provisioning mechanism, the RP only learns of the existence of a subscriber account when that account is first used at the RP. If the IdP does not inform the RP of terminated subscriber accounts using shared signaling as described in <a href="/800-63-4/sp800-63c/GenIdP/#shared-signals">Sec 4.8</a>, an RP could accumulate RP subscriber accounts that are no longer accessible from the IdP. This poses a risk to the RP for holding personal information in the RP subscriber accounts. In such circumstances, the RP <strong>MAY</strong> employ a time-based mechanism to identify RP subscriber accounts for termination that have not been accessed after a period of time tailored to the usage patterns of the application. For example, an RP that is usually accessed on a weekly basis could set a timeout of 120 days since last access at the RP to mark the RP subscriber account for termination. An RP that expects longer gaps between access, such as a service used annually, should have a much longer time frame, such as five years.</p>

<p>When processing such an inactive account, the RP <strong>SHALL</strong> provide sufficient notice to the subscriber, about the pending termination of the account and provide the subscriber with an option to re-activate the account prior to its scheduled termination. Upon termination, the RP <strong>SHALL</strong> remove all personal information associated with the RP subscriber account, in accordance with <a href="/800-63-4/sp800-63c/Federation/#store-subscriber-info">Sec. 3.10.3</a>.</p>
<h2 id="federation-session" data-section="4">
  
  
    Reauthentication and Session Requirements in Federated Environments <a href="#federation-session" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h2>
    

<p>In a federated environment, the RP manages its sessions separately from any sessions at the IdP. The assertion is related to both sessions but its validity period is ultimately independent of them.</p>

<p>As shown in <a href="/800-63-4/sp800-63c/GenIdP/#fig-10">Fig. 10</a>, an assertion is created during an authenticated session at the IdP, and processing an assertion creates an authenticated session at the RP. The validity time window of an assertion is used to manage the RP’s processing of the assertion but does not indicate the lifetime of the authenticated session at the IdP or the RP. If a request comes to the IdP for a new federation transaction while the subscriber’s session is still valid at the IdP, a new and separate assertion would be created with its own validity time window. Similarly, after the RP consumes the assertion, the validity of the RP’s session is independent of the validity of the assertion, and in most cases the authenticated session at the RP will far outlive the validity of the assertion. Access granted to an identity API is likewise independent of the validity of the assertion or the lifetime of the authenticated session at the RP.</p>

<p latex-ignore="true"><a href="/800-63-4/sp800-63c/GenIdP/#fig-session" name="fig-10">Fig. 10. Session Lifetimes</a></p>

<p><img src="/800-63-4/sp800-63c/images/Session.png" alt="Diagram of the relationship between session lifetimes at the IdP and RP and assertion validity window." title="Session Lifetimes" latex-src="Session.pdf" latex-fig="10" latex-place="h" /></p>

<p>The IdP ending the subscriber’s session at the IdP will not necessarily cause any sessions that subscriber might have at downstream RPs to end as well. The RP and IdP <strong>MAY</strong> communicate end-session events to each other, if supported by the federation protocol or through shared signaling (see <a href="/800-63-4/sp800-63c/GenIdP/#shared-signals">Sec. 4.8</a>).</p>

<p>At the time of a federated transaction request, the subscriber could have a pre-existing authenticated session at the IdP which <strong>MAY</strong> be used to generate an assertion to the RP. The IdP <strong>SHALL</strong> communicate to the RP any information the IdP has regarding the time of the subscriber’s latest authentication event at the IdP, and the RP <strong>MAY</strong> use this information in making authorization and access decisions. Depending on the capabilities of the federation protocol in use, the IdP <strong>SHOULD</strong> allow the RP to request that the subscriber provide a fresh authentication at the IdP instead of using the existing session at the IdP. For example, suppose the subscriber authenticates at the IdP for one transaction. Then, 30 min later, the subscriber starts a federation transaction at the RP. Depending on xAL requirements, the subscriber’s existing session at the IdP can be used to avoid prompting the subscriber for their authenticators. The resulting assertion to the RP will indicate that the last time the subscriber had authenticated to the RP was 30 min in the past. The RP can then use this information to determine whether this is reasonable for the RP’s needs, and, if possible within the federation protocol, request the IdP to prompt the subscriber for a fresh authentication event instead.</p>

<p>An RP requiring authentication through a federation protocol <strong>SHALL</strong> specify the maximum acceptable authentication age to the IdP, either through the federation protocol (if possible) or through the terms of the trust agreement. The authentication age represents the time since the last authentication event in the subscriber’s session at the IdP, and the IdP <strong>SHALL</strong> reauthenticate the subscriber if they have not been authenticated within that time period. The IdP <strong>SHALL</strong> communicate the authentication event time to the RP to allow the RP to decide if the assertion is sufficient for authentication at the RP and to determine the time for the next reauthentication event.</p>

<p>If an RP is granted access to an identity API at the same time the RP receives an assertion, the lifetime of the access to the identity API is independent from the lifetime of the assertion. As a consequence, the RP’s ability to successfully fetch additional attributes through an identity API <strong>SHALL NOT</strong> be used to establish a session at the RP. Likewise, inability to access an identity API <strong>SHOULD NOT</strong> be used to end the session at the RP.</p>

<p>When the RP is granted access to the identity API, the RP is often also granted access to other APIs at the same time, such as granting access to a subscriber’s calendar and data storage while also logging in. It is common for this access to be valid long after the assertion has expired and possibly after the session with the RP has ended, allowing the RP to access these non-identity APIs on the subscriber’s behalf while the subscriber is no longer present at the RP. Providing access to non-identity APIs is outside the scope of these guidelines.</p>

<p>The RP <strong>MAY</strong> terminate its authenticated session with the subscriber or restrict access to the RP’s functions if the assertion, authentication event, or attributes do not meet the RP’s requirements. For example, if an RP is configured to allow access to certain high-risk functionality only if the federation transaction was at FAL3, but the incoming assertion only meets the requirements for FAL2, the RP could decide to deny access to the high-risk functionality while allowing access to lower-risk functionality, or the RP could choose to terminate the session entirely.</p>

<p>See <a href="/800-63-4/sp800-63b/session/#sec7" latex-href="#ref-SP800-63B">[SP800-63B] Sec. 5</a> for more information about session management requirements that apply to both IdPs and RPs.</p>
<h2 id="shared-signals" data-section="4">
  
  
    Shared Signaling <a href="#shared-signals" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h2>
    

<p>In some environments, it is useful for the IdP and RP to send information to each other outside of the federation transaction. These signals can communicate important changes in state between parties that would not be otherwise known. The use of any shared signaling <strong>SHALL</strong> be documented in the trust agreement between the IdP and RP. Signaling from the IdP to the RP <strong>SHALL</strong> require an apriori trust agreement. Signaling from the RP to the IdP <strong>MAY</strong> be used in both apriori and subscriber-driven trust agreements.</p>

<p>Any use of shared signaling <strong>SHALL</strong> be documented and made available to the authorized party stipulated by the trust agreement. This documentation <strong>SHALL</strong> include the events under which a signal is sent, the information included in such a signal (including any attribute information), and any additional parameters sent with the signal. The use of shared signaling <strong>SHALL</strong> be subject to privacy review under the trust agreement.</p>

<p>The IdP <strong>SHOULD</strong> send a signal regarding the following changes to the subscriber account:</p>

<ul>
  <li>The account has been terminated.</li>
  <li>The account is suspected of being compromised.</li>
  <li>Attributes of the account, including identifiers other than the federated identifier (such as email address or certificate common name), have changed.</li>
  <li>The possible range of IAL, AAL, or FAL for the account has changed.</li>
</ul>

<p>If the RP receives a signal that an RP subscriber account is suspected of compromise, the RP <strong>SHOULD</strong> review actions taken by that account at the RP for suspicious activity.</p>

<p>The RP <strong>SHOULD</strong> send a signal regarding the following changes to the RP subscriber account:</p>

<ul>
  <li>The account has been terminated.</li>
  <li>The account is suspected of being compromised.</li>
  <li>A bound authenticator is added by the RP.</li>
  <li>A bound authenticator is removed by the RP.</li>
</ul>

<p>If the IdP receives a signal that a subscriber account is suspected of compromise, the IdP <strong>SHALL</strong> review actions taken by that account at the IdP for suspicious activity. If suspicious activity is confirmed at the IdP, the IdP <strong>SHALL</strong> signal any additional RPs the subscriber account was used for during the suspected time frame.</p>

<p>Additional signals from both the IdP and RP <strong>MAY</strong> be allowed subject to privacy and security review as part of the trust agreement.</p>
<h2 id="assertions" data-section="4">
  
  
    Assertion Contents <a href="#assertions" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h2>
    

<p>An assertion is a packaged set of attribute values or derived attribute values about or associated with an authenticated subscriber that is passed from the IdP to the RP in a federated identity system. Assertions contain a variety of information, including: assertion metadata, attribute values and derived attribute values about the subscriber, information about the subscriber’s authentication at the IdP, and other information that the RP can leverage (e.g., restrictions and validity time window). While the assertion’s primary function is to authenticate the user to an RP, the information conveyed in the assertion can be used by the RP for a number of use cases — for example, authorization or personalization of a website. These guidelines do not restrict RP use cases nor the type of protocol or data payload used to federate an identity, provided that the chosen solution meets all mandatory requirements contained herein.</p>

<p>Assertions <strong>SHALL</strong> represent a discrete authentication event of the subscriber at the IdP and <strong>SHALL</strong> be processed as a discrete authentication event at the RP.</p>

<p>All assertions <strong>SHALL</strong> include the following attributes:</p>

<ol>
  <li>Subject identifier: An identifier for the party to which the assertion applies (i.e., the subscriber).</li>
  <li>Issuer identifier: An identifier for the issuer of the assertion (i.e., the IdP).</li>
  <li>Audience identifier: An identifier for the party intended to consume the assertion (i.e., the RP). An assertion can contain more than one audience identifier at FAL1.</li>
  <li>Issuance time: A timestamp indicating when the IdP issued the assertion.</li>
  <li>Validity time window: A period of time outside of which the assertion <strong>SHALL NOT</strong> be accepted as valid by the RP for the purposes of authenticating the subscriber and starting an authenticated session at the RP. This is usually communicated by means of an expiration timestamp for the assertion in addition to the issuance timestamp.</li>
  <li>Assertion identifier: A value uniquely identifying this assertion, used to prevent attackers from replaying prior assertions.</li>
  <li>Authentication time: A timestamp indicating when the IdP last verified the presence of the subscriber at the IdP through a primary authentication event.</li>
  <li>Nonce: A cryptographic nonce, if one is provided by the RP.</li>
  <li>Signature: Digital signature or message authentication code (MAC), including key identifier, covering the entire assertion.</li>
</ol>

<p>All assertions <strong>SHALL</strong> contain sufficient information to determine the following aspects of the federation transaction:</p>

<ol>
  <li>The IAL of the subscriber account being represented in the assertion, or an indication that no IAL is asserted.</li>
  <li>The AAL used when the subscriber authenticated to the IdP, or an indication that no AAL is asserted.</li>
  <li>The IdP’s intended FAL of the federation process represented by the assertion.</li>
</ol>

<p>At FAL3, the assertion <strong>SHALL</strong> include one of the following:</p>

<ul>
  <li>The public key, key identifier, or other identifier for a holder-of-key assertion, or</li>
  <li>An indicator that verification of a bound authenticator is required to process this assertion.</li>
</ul>

<p>Assertions <strong>MAY</strong> also include additional items, including the following information:</p>

<ol>
  <li>Attribute values and derived attribute values: Information about the subscriber.</li>
  <li>Attribute bundles: Collections of attributes in a signed bundle from the CSP.</li>
  <li>Attribute metadata: Additional information about one or more subscriber attributes, such as those described in <a href="/800-63-4/sp800-63c/references/#ref-nistir8112">[NISTIR8112]</a>.</li>
  <li>Authentication event: Additional details about the authentication event, such as the class of authenticator used.</li>
</ol>

<p>The RP <strong>SHALL</strong> validate the assertion by checking that all the following are true:</p>

<ul>
  <li><em>Signature validation</em>: ensuring that the signature of the assertion is valid and corresponds to a key belonging to the IdP sending the assertion.</li>
  <li><em>Issuer verification</em>: ensuring that the assertion was issued by the IdP the RP expects it to be from.</li>
  <li><em>Time validation</em>: ensuring that the expiration and issue times are within acceptable limits of the current timestamp.</li>
  <li><em>Audience restriction</em>: ensuring that this RP is the intended recipient of the assertion.</li>
  <li><em>Nonce</em>: ensuring that the cryptographic nonce included in the RP’s request (if applicable) is included in the presentation.</li>
  <li><em>Transaction terms</em>: ensuring that the IAL, AAL, and FAL represented by the assertion are allowable under the applicable trust agreement.</li>
</ul>

<p>An RP <strong>SHALL</strong> treat subject identifiers as not inherently globally unique. Instead, the value of the assertion’s subject identifier is usually in a namespace under the assertion issuer’s control, as discussed in <a href="/800-63-4/sp800-63c/Federation/#federated-identifier">Sec. 3.3</a>. This allows an RP to talk to multiple IdPs without incorrectly conflating subjects from different IdPs.</p>

<p>Assertions <strong>MAY</strong> include additional attributes about the subscriber. <a href="/800-63-4/sp800-63c/Federation/#privacy-reqs">Section 3.9</a> contains privacy requirements for presenting attributes in assertions. The RP <strong>MAY</strong> be given limited access to an identity API as discussed in <a href="/800-63-4/sp800-63c/Federation/#s-identity-api">Sec. 3.11.3</a>, either in the same response as the assertion is received or through some other mechanism. The RP can use this API to fetch additional identity attributes for the subscriber that are not included in the assertion itself.</p>

<p>The assertion’s validity time window is the time between its issuance and its expiration. This window needs to be large enough to allow the RP to process the assertion and create a local application session for the subscriber, but should not be longer than necessary for such establishment. Long-lived assertions have a greater risk of being stolen or replayed; a short assertion validity time window mitigates this risk. Assertion validity time windows <strong>SHALL NOT</strong> be used to limit the session at the RP. See <a href="/800-63-4/sp800-63c/GenIdP/#federation-session">Sec. 4.7</a> for more information.</p>
<h2 id="assertion-requests" data-section="4">
  
  
    Assertion Requests <a href="#assertion-requests" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h2>
    

<p>When the federation transaction is initiated by the RP, the RP’s request for an assertion <strong>SHALL</strong> contain:</p>

<ol>
  <li>An identifier for the RP</li>
  <li>A cryptographic nonce, to be returned in the assertion</li>
</ol>

<p>The RP’s request <strong>SHOULD</strong> additionally contain:</p>

<ol>
  <li>The set of identity attributes requested by the RP and their purpose of use at the RP; this is a subset of what is allowed by the trust agreement</li>
  <li>The requirements for the authentication event at the IdP</li>
</ol>

<p>Note that federation transactions are always initiated by the RP at FAL2 or higher.</p>
<h2 id="presentation" data-section="4">
  
  
    Assertion Presentation <a href="#presentation" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h2>
    

<p>Depending on the specifics of the protocol, the RP and the IdP communicate with each other in two ways, which lends to two different ways in which an assertion can be passed from the IdP to the RP:</p>

<ul>
  <li>The <em>back channel</em>, through a direct connection between the RP and IdP, not involving the subscriber directly; or</li>
  <li>The <em>front channel</em>, through a third party using redirects involving the subscriber and the subscriber’s browser.</li>
</ul>

<p>There are tradeoffs with each model, but each requires the proper validation of the assertion. Assertions <strong>MAY</strong> also be proxied to facilitate federation between IdPs and RPs using different presentation methods, as discussed in detail in <a href="/800-63-4/sp800-63c/Federation/#proxied">Sec. 3.2.3</a>.</p>
<h3 id="back-channel" data-section="4">
  
  
    Back-Channel Presentation <a href="#back-channel" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h3>
    

<p>In the <em>back-channel</em> presentation model shown in <a href="/800-63-4/sp800-63c/GenIdP/#fig-11">Fig. 11</a>, the subscriber is given an assertion reference to present to the RP, generally through the front channel. The assertion reference itself contains no information about the subscriber and <strong>SHALL</strong> be resistant to tampering and fabrication by an attacker. The RP presents the assertion reference to the IdP to fetch the assertion. How this is achieved varies form one protocol to the next. In the authorization code flow and some forms of the hybrid flow of <a href="/800-63-4/sp800-63c/references/#ref-OIDC">[OIDC]</a> the assertion (the ID Token) is presented in the back channel in exchange for the assertion reference (the authorization code). In the artifact binding profile of <a href="/800-63-4/sp800-63c/references/#ref-SAML-bindings">[SAML-Bindings]</a>, the SAML assertion is presented in the back channel.</p>

<div latex-literal="true" class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\clearpage
</code></pre></div></div>

<p latex-ignore="true"><a href="/800-63-4/sp800-63c/GenIdP/#fig-63cSec7-Figure1" name="fig-11">Fig. 11. Back-channel Presentation</a></p>

<p><img src="/800-63-4/sp800-63c/images/back-channel.png" alt="Diagram of the back-channel presentation model for communicating assertions to the RP." title="Back-channel Presentation" latex-src="back-channel.pdf" latex-fig="11" latex-place="h" /></p>

<p>As shown in <a href="/800-63-4/sp800-63c/GenIdP/#fig-11">Fig. 11</a>, the back-channel presentation model consists of three steps:</p>

<ol>
  <li>The IdP sends an assertion reference to the subscriber through the front channel.</li>
  <li>The subscriber sends the assertion reference to the RP through the front channel.</li>
  <li>The RP presents the assertion reference and its RP credentials to the IdP through the back channel. The IdP validates the credentials and returns the assertion.</li>
</ol>

<p>The assertion reference:</p>

<ol>
  <li><strong>SHALL</strong> be limited to use by a single RP.</li>
  <li><strong>SHALL</strong> be single-use.</li>
  <li><strong>SHALL</strong> be time limited, and <strong>SHOULD</strong> have a validity time window of no more than five minutes.</li>
  <li><strong>SHALL</strong> be presented along with authentication of the RP to the IdP.</li>
  <li><strong>SHALL NOT</strong> be predictable or guessable by an attacker.</li>
</ol>

<p>In this model, the RP directly requests the assertion from the IdP, minimizing chances of interception and manipulation by a third party (including the subscriber themselves).
More network transactions are required in the back-channel method, but the information is limited to only those parties that need it. Since an RP is expecting to get an assertion only from the IdP directly as a result of its request, the attack surface is reduced. Consequently, it is more difficult to inject assertions directly into the RP and this presentation method is recommended for FAL2 and above.
Since the IdP and RP are already directly connected, the back-channel presentation method facilitates the use of identity APIs, as described in <a href="/800-63-4/sp800-63c/Federation/#s-identity-api">Sec. 3.11.3</a>.</p>

<p>Note that while it is technically possible for an assertion reference (which is single-audience) to result in a multi-audience assertion, this situation is unlikely. For this reason, back-channel presentation is practically limited to use with single-audience assertions.</p>

<p>Conveyance of the assertion reference from the IdP to the subscriber, as well as from the subscriber to the RP, <strong>SHALL</strong> be made over an authenticated protected channel. Conveyance of the assertion reference from the RP to the IdP, as well as the assertion from the IdP to the RP, <strong>SHALL</strong> be made over an authenticated protected channel.</p>

<p>The RP <strong>SHALL</strong> protect itself against injection of manufactured or captured assertion references by the use of cross-site scripting protection, rejecting assertion references outside of the correct stage of a federation transaction, or other accepted techniques discussed in <a href="/800-63-4/sp800-63c/Federation/#injection-protection">Sec. 3.10.1</a>.
When assertion references are presented to the IdP, the IdP <strong>SHALL</strong> verify that the RP presenting the assertion reference is the same RP that made the assertion request resulting in the assertion reference. Examples for this are discussed in <a href="/800-63-4/sp800-63c/examples/#rp-auth">Sec 10.12</a> such as the authorization code flow of <a href="/800-63-4/sp800-63c/references/#ref-OIDC">[OIDC]</a> with additional security profiles such as <a href="/800-63-4/sp800-63c/references/#ref-FAPI">[FAPI]</a>.</p>

<p>Note that in a federation proxy described in <a href="/800-63-4/sp800-63c/Federation/#proxied">Sec. 3.2.3</a>, the upstream IdP audience restricts the assertion reference and assertion to the proxy, and the proxy restricts any newly-created assertion references or assertions to the downstream RP.</p>
<h3 id="front-channel" data-section="4">
  
  
    Front-Channel Presentation <a href="#front-channel" class="header-link"><i class="fa fa-link"></i></a>
  
  
</h3>
    

<p>In the <em>front-channel</em> presentation model shown in <a href="/800-63-4/sp800-63c/GenIdP/#fig-12">Fig. 12</a>, the IdP creates an assertion and sends it to the RP by means of a third party, such as the subscriber’s user agent. In the implicit flow and some forms of the hybrid flow of <a href="/800-63-4/sp800-63c/references/#ref-OIDC">[OIDC]</a>, the assertion (the ID Token) is presented in the front channel.  In the SAML Web SSO profile defined in <a href="/800-63-4/sp800-63c/references/#ref-SAML-WebSSO">[SAML-WebSSO]</a>, the SAML assertion is presented in the front channel.</p>

<p latex-ignore="true"><a href="/800-63-4/sp800-63c/GenIdP/#fig-13" name="fig-12">Fig. 12. Front-channel Presentation</a></p>

<p><img src="/800-63-4/sp800-63c/images/front-channel.png" alt="Diagram of the front-channel presentation model for communicating assertions to the RP." title="Front-channel Presentation" latex-src="front-channel.pdf" latex-fig="12" latex-place="h" /></p>

<p>Front-channel presentation methods expose the assertion to parties other than the IdP and RP, which increases the risk for leakage of PII and other information included in the assertion. Additionally, there is an increased attack surface for the assertion to be captured and replayed by an attacker. As a consequence, it is recommended to not use front-channel presentation when other mechanisms are available.</p>

<p>The RP <strong>SHALL</strong> use the assertion identifier ensure that a given assertion is presented at most once during the assertion’s validity time window.</p>

<p>The RP <strong>SHALL</strong> protect itself against injection of manufactured or captured assertion by the use of cross-site scripting protection, rejecting assertions outside of the correct stage of a federation transaction, or other accepted techniques discussed in <a href="/800-63-4/sp800-63c/Federation/#injection-protection">Sec. 3.10.1</a>.</p>

<p>Conveyance of the assertion from the IdP to the subscriber, as well as from the subscriber to the RP, <strong>SHALL</strong> be made over an authenticated protected channel.</p>

<p>With general-purpose IdPs, it is common for front-channel communications to be accomplished using HTTP redirects, where the contents of the assertion are made available as part of an HTTP request URL. Due to the nature of the HTTP ecosystem, these request URLs are sometimes available in unexpected places, such as access logs and browser history. These logs and other artifacts tend to live on long past the federation transaction and are available in other contexts, which increases the attack surface for reading the assertion. As a consequence, an IdP that uses HTTP redirects for front channel presentation of assertions that contain PII <strong>SHALL</strong> encrypt the assertion as discussed in <a href="/800-63-4/sp800-63c/Federation/#encrypted-assertion">Sec 3.12.3</a>.</p>


  



  </div>
</div>
<footer role="contentInfo" class="site-footer">
  <div class="section-container">
    <div class="section-content">
    </div>
  </div>
</footer>

<script type="text/javascript">
    function loadSearch() {
        var sjs = SimpleJekyllSearch({
          searchInput: document.getElementById('search-input'),
          resultsContainer: document.getElementById('results-container'),
          json: '/800-63-4/search.json'
        });
    }
    $(function() {
      
      // highlight normative language by adding classes
      $('strong').filter(':contains("SHALL"), :contains("SHALL NOT"), :contains("SHOULD"), :contains("SHOULD NOT"), :contains("MAY"), :contains("NEED NOT"), :contains("CAN"), :contains("CANNOT"), :contains("CAPITALS")').each(function(i, el) {
        var $el;
        $el = $(el);
        $el.addClass('normative');
      });
      // highlight the target
      $('a:target').parent().addClass('target');
      $(':target').addClass('target');
      $(window).on('hashchange', function(e) {
        $('.target').removeClass('target');
        $('a:target').parent().addClass('target');
        $(':target').addClass('target');
      });
    });
</script>


</body>
</html>